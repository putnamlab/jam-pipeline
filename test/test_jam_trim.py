import unittest
import os
#import random
import subprocess
import hashlib 


cksums={"Ltest3_p6_1_f.fam.gz":"f4a71ded2921e7f8617a5229ffdd049cca4bd339", "Ltest3_p6_1_r.fam.gz":"0e0daa1ac97aea4b09a65c1f1e05aabc75c89677", "Ltest3_p6_2_f.fam.gz":"648a4c88bdb155d815539f17aa84945b828b4e9e", "Ltest3_p6_2_r.fam.gz":"c2e3004b7cf77842a5a8f94a8d9c8f9ed9635604", "Ltest3_p6_3_f.fam.gz":"9ae4b23df25994e85dc7c37c4d202a5f6be6bf81", "Ltest3_p6_3_r.fam.gz":"59329b01ed5d994165a2e4d44777b3dd927be80d", "Ltest3_p6_4_f.fam.gz":"fd626037bfb1b6894cab9b49fb63cb7f5450ee32", "Ltest3_p6_4_r.fam.gz":"6cff35c2e2775985f67101c27390cd072787487b", "Ltest3_p6_5_f.fam.gz":"5fe01a972af32192a372d1026c7c694dffd6b13f", "Ltest3_p6_5_r.fam.gz":"dff28969d3a4beacfe749001744b78e3364ad5a0", "Ltest3_p6_6_f.fam.gz":"b278487029f73964d60a014fdbae3a8797725a0f", "Ltest3_p6_6_r.fam.gz":"e643f2530efa6fad90116b0d87e2621f4ebf5c5e", "Ltest3_p6_7_f.fam.gz":"77c410504ba3ca387fe66f0dbcfa495c3dbe0d3d", "Ltest3_p6_7_r.fam.gz":"8ee6e8643660a46bfdcc49626bd2fd19cb0e7849", "Ltest3_p6_8_f.fam.gz":"d10715c933d9a53ce7de95c197fd99e3cb69f308", "Ltest3_p6_8_r.fam.gz":"0736198912b1860f873d603832cf3f90874e5ce7", "Ltest3_p7_1_f.fam.gz":"fa2dfcde29ffb416d0d3c8658f143922a94a8c04", "Ltest3_p7_1_r.fam.gz":"697e8810d271b99d7186d0eae342e8ebbf560910", "Ltest3_p7_2_f.fam.gz":"45963083aaf5889a3266f857b5a11651bb793df1", "Ltest3_p7_2_r.fam.gz":"620e8dd354df22bf4de98f04d6d5ba6e116bfd71", "Ltest3_p7_3_f.fam.gz":"c84d330c15c1d9a86084613b3f50128cf6dc58d8", "Ltest3_p7_3_r.fam.gz":"2d672d5dd24e7aae0e0ad1256d6523be48a623cc", "Ltest3_p7_4_f.fam.gz":"dbc0ac80f91122576cb65fb934f543f19c4c0efb", "Ltest3_p7_4_r.fam.gz":"55ed7e611f63c89da49f0f5466759a55e8f92924", "Ltest3_p7_5_f.fam.gz":"f7510de9c680a4f14e5621ed30aaa74745abea29", "Ltest3_p7_5_r.fam.gz":"8f9862865fe3eb3a7a8fde99187c8db8abe62b5c", "Ltest3_p7_6_f.fam.gz":"2424a12202036066505d471e7886016cddee39a4", "Ltest3_p7_6_r.fam.gz":"f2e9752b7d949f31894aa3f80c4b5ad0b39eb4db", "Ltest3_p7_7_f.fam.gz":"314c37482760e9fbd7267b294c116ab74d3ead64", "Ltest3_p7_7_r.fam.gz":"e9f3b4dd85f07d1b5e870a874d04e8b1418704fc", "Ltest3_p7_8_f.fam.gz":"546e033c105d6ae06f8c904adf68b3eec3ed36d9", "Ltest3_p7_8_r.fam.gz":"36916fcb813fc016ba646ee340132916b46378a0", "Ltest4_10_1_f.fam.gz":"bd07c6bd28834ee526882f9ab74ec453bcf8e624", "Ltest4_10_1_r.fam.gz":"4bacc1de35863a3b56c6d8b7e651a62d0d69848e", "Ltest4_10_2_f.fam.gz":"e7edbb4075922a80112f3b90ce221517df2bd5fa", "Ltest4_10_2_r.fam.gz":"fe98a673542c9fdeeadca90c69abaf2aef08806c", "Ltest4_10_3_f.fam.gz":"6a6ae6a64e84d0e90f42de788c3a30c852bc6ff6", "Ltest4_10_3_r.fam.gz":"67dc9350d7a3b84b3ea5f4cd25740fb94d81bf2c", "Ltest4_1_1_f.fam.gz":"11c6d0a4fd7ed474a88233d9566abb61db69ec98", "Ltest4_1_1_r.fam.gz":"200d691eb9431896c9b653c8b577658fa964fed7", "Ltest4_1_2_f.fam.gz":"8ea270c64669494df348739b3048ef94cbab6dee", "Ltest4_1_2_r.fam.gz":"8d1830c373db6f9aca9e224d3eb507e8aa0d3f71", "Ltest4_1_3_f.fam.gz":"6ac5a57f23a8342c9ea129206106185e46188d90", "Ltest4_1_3_r.fam.gz":"877c895542a94e0286726e6d1f86a228dad94933", "Ltest4_2_1_f.fam.gz":"3c67204518da9e9df57a7ff82997a9c078e925e1", "Ltest4_2_1_r.fam.gz":"2217d8d4cfbeae23b502857d8bfabcfae0e6e515", "Ltest4_2_2_f.fam.gz":"2d50e11cbf4cd42026780741aa473fb87acdfc08", "Ltest4_2_2_r.fam.gz":"7859df1b5bd4cb30e1f21fc6819409b68bf86c6d", "Ltest4_3_1_f.fam.gz":"78a6d333e1a51c4444b5e17ee8390d80b45ba5b8", "Ltest4_3_1_r.fam.gz":"399045bd9813c604ef71997723e0adb6c2424a3a", "Ltest4_3_2_f.fam.gz":"fcf67621fb466ff9b00691688458ea54d02dc5ff", "Ltest4_3_2_r.fam.gz":"d6fbf9775272724986a7c08814d58161cd0fe527", "Ltest4_3_3_f.fam.gz":"630944975c6c8b6becd914e6e903fee1f79c218d", "Ltest4_3_3_r.fam.gz":"c9308b815efb67dc51ad83bd5a74de6ddd00ea7e", "Ltest4_4_1_f.fam.gz":"9961991335e8b79d92eedaf9d3274a50b201b28e", "Ltest4_4_1_r.fam.gz":"1d35365e311da1eaf67aed228ee0c99b642a9f25", "Ltest4_4_2_f.fam.gz":"10627f3fcf3ef41fac90ab077bb0ff6df9b4de11", "Ltest4_4_2_r.fam.gz":"376c7c0ced7a4f0e56c585ddb826cc8deae61a4b", "Ltest4_4_3_f.fam.gz":"4a3ab228a0348768594a56c65a5ad4a5b8813c54", "Ltest4_4_3_r.fam.gz":"5401650dc722ed834c153625c54bd2a9a639d93e", "Ltest4_5_1_f.fam.gz":"575a48ae8204f638b4e49227d9dbd5fa5a783f6f", "Ltest4_5_1_r.fam.gz":"9792ad44fe4ef18a0767e448fb68d579af67dcf6", "Ltest4_5_2_f.fam.gz":"d5c9c3f0fb0ee49dc52e884bd283df8401dfb3af", "Ltest4_5_2_r.fam.gz":"cc01a968c0c8abd3bb7968d028e955f68367a19e", "Ltest4_6_1_f.fam.gz":"ed6bf15f79757e9f031e9a61238e70284fca71d5", "Ltest4_6_1_r.fam.gz":"33c9ccb09453743c7b0d8186c05e24ed4ada4523", "Ltest4_6_2_f.fam.gz":"cfdf2d23c26d619f663789429afbcbaf96ffe3b6", "Ltest4_6_2_r.fam.gz":"9989a1f78a49a9a17689f1d22aaaf8ae3c457bf8", "Ltest4_6_3_f.fam.gz":"61b08421b5c4671b43f98acc73757723aa00d6ca", "Ltest4_6_3_r.fam.gz":"1bc15af802a34e9892c46fe6755eb46174c38de6", "Ltest4_6_4_f.fam.gz":"b9d28daaff3dd80c425037ea99c045024f8625c8", "Ltest4_6_4_r.fam.gz":"cbedd48d6c203af33f15c3cd216b00a7543b03a3", "Ltest4_6_5_f.fam.gz":"80ecb877458409b7c4807aee0813f107a79b195e", "Ltest4_6_5_r.fam.gz":"5d946e9487d5b17e737c9ada63f2dfd21640207a", "Ltest4_7_1_f.fam.gz":"a8200bea2e3a407551b2a5a8aa628c3b66ce5c7e", "Ltest4_7_1_r.fam.gz":"ca090a78ba5ace418c7d07c34d978c29016ba5b9", "Ltest4_7_2_f.fam.gz":"df11a91f8af2c4492f727e0e0765365b9dc56202", "Ltest4_7_2_r.fam.gz":"e2016eaf581b4f064c646cd49434ece07055c2e0", "Ltest4_7_3_f.fam.gz":"1f1022620ea3110e98781080796003b7b87959a9", "Ltest4_7_3_r.fam.gz":"0afdc5bfa6580e814c1cac496504cd8d36bb836c", "Ltest4_7_4_f.fam.gz":"c9c94cfd292c78c57d405be12093a3b011c19d51", "Ltest4_7_4_r.fam.gz":"df3737f1a0fe980731d291541284fa20e260c347", "Ltest4_8_1_f.fam.gz":"47bafae2a5b273717b5b95dbde408eb338c1bb02", "Ltest4_8_1_r.fam.gz":"6d42d9183e69904a00eb6ab13217ff2efa311956", "Ltest4_8_2_f.fam.gz":"7d354cedbffedb4f023f711ea93de7fc1f3d71fe", "Ltest4_8_2_r.fam.gz":"8a869abd2c0e8366506f624ba0a30ad01b87579f", "Ltest4_8_3_f.fam.gz":"1f184d0cfbbd15cafb2c1ea29754eee6838aaacf", "Ltest4_8_3_r.fam.gz":"6d12e7fad33503bc93f292f9120f7a3a670842a6", "Ltest4_8_4_f.fam.gz":"3693c5bf04630a21d93b79760636a309bed091ec", "Ltest4_8_4_r.fam.gz":"04c692ca603567e35c64a21c47cbc3d7529c7cb9", "Ltest4_9_1_f.fam.gz":"89e5963974ff7022d3977c31a7bcef514d9efb49", "Ltest4_9_1_r.fam.gz":"753be6f035c4a510b229c16153663237a164e225", "Ltest4_9_2_f.fam.gz":"fc348618130cf17f115b18e5bcd9ebe2b4f9bbd5", "Ltest4_9_2_r.fam.gz":"0aded5a1c9e85928c700a75c0c44bb20b811f3b6", "Ltest5_11_f.fam.gz":"8953523b48f6cd41d285f6dbbac5e2d60a4d68b4", "Ltest5_11_r.fam.gz":"8aa74c28ee161b913b73be2bfe17a64c38b85cb8", "Ltest5_12_f.fam.gz":"a4080e6e54b0bbcfb27969c4903e863c3e8a5550", "Ltest5_12_r.fam.gz":"69473f935b41172f7e2035649aac7316f43081c1", "Ltest5_13_f.fam.gz":"8ffd13163a251b7ca74ebdfd1ca99eb099fddcb3", "Ltest5_13_r.fam.gz":"564c8ba8fafa5dee200bb3b303f6bd7e05bdbb06", "Ltest5_14_f.fam.gz":"5c329dbe2933204edfdba8698f41ee647b18d531", "Ltest5_14_r.fam.gz":"bf9cdecc309cb22852667580404b449f982757c5", "Ltest5_15_f.fam.gz":"8b42b7e7381a91cfab2e7a5262c8ec636741dba9", "Ltest5_15_r.fam.gz":"394ef4554eb1693c7b99a7411adb7bebae328cb0", "Ltest5_16_f.fam.gz":"b9acbfbe1213c60ab1a818357e92d2250c37711f", "Ltest5_16_r.fam.gz":"344b668be7b0328402aff3e6b59055a77c275c73", "Ltest5_17_f.fam.gz":"ce341580c251436c148291d3fe076f442e22c495", "Ltest5_17_r.fam.gz":"c7cad7d6baf86c21cd92b6cf158d0563c0ff32bd", "Ltest5_18_f.fam.gz":"f3de206a741981ef0ebe660b32adffcd7235527c", "Ltest5_18_r.fam.gz":"2721b270f73512560b0f522884708e5458f5b74b", "Ltest5_19_f.fam.gz":"9fca1f00b796aaa18661c0be8453c84ea0765bb3", "Ltest5_19_r.fam.gz":"5def86b4857124156d67cb071a4a9ffc1b89cda3", "Ltest5_20_f.fam.gz":"d5de49ef69f0480a61bd684f5c1ab24efd5c7e19", "Ltest5_20_r.fam.gz":"2c860456869ede828997dc96189e0fa827c05ca2", "Ltest5_21_f.fam.gz":"1e5e0b6f4cd653dff7eebc27d69a01733fbef483", "Ltest5_21_r.fam.gz":"85379ccac2e828edac706385b92cea46f0c07018", "Ltest5_22_f.fam.gz":"0c9e520d1d18b9f1902ee088c47838c8d6387d26", "Ltest5_22_r.fam.gz":"8fed8490d44281264dd58128fd08c84829535b24", "Ltest6_23_f.fam.gz":"70cb92767eb60bbc062d627a2d905cd8142612dc", "Ltest6_23_r.fam.gz":"bed3080b426287ae5330a66065ca5abbd3cb7984", "Ltest6_24_f.fam.gz":"90d6ff4cd198c10c84cd20fbb71f84da93ac9dd1", "Ltest6_24_r.fam.gz":"cea8dd5f8e7743393572d377cb1e2ad553233fa7", "Ltest6_25_f.fam.gz":"ece9c7ecff632eb28d8cdb294b93861048ced96c", "Ltest6_25_r.fam.gz":"e5542f1735049bdedc4843b9d19418e9c8e810f2", "Ltest6_26_f.fam.gz":"666445231d6855ff2384b1ec268ee2c50355a559", "Ltest6_26_r.fam.gz":"806ceebf74a1d2dc677c8727c460d0a26b170860", "Ltest6_27_f.fam.gz":"1109b532bf436769afdededa26a9ef6bac316d99", "Ltest6_27_r.fam.gz":"bc1a65ad17d91dbf8e61319df412857812da4c56", "Ltest6_28_f.fam.gz":"79a94fb9344a37bb906213ce08ccd269c6667b59", "Ltest6_28_r.fam.gz":"d6b3a56c054fa335aeaae7b80ddb3eb490c787b9", "Ltest6_29_f.fam.gz":"fa519ba002404c2e36288edb76c27296f999d334", "Ltest6_29_r.fam.gz":"9332ae1dc1c7ce52b2b43914999abb4d91827387", "Ltest6_30_f.fam.gz":"3a411b7b8fd8500d539fdbc03c658c0d4dbf701f", "Ltest6_30_r.fam.gz":"d01d8b214809f256e6c6cb76078966282a56d7c1", "Ltest6_31_f.fam.gz":"35e7241de78dd657dac87e3125b974b8196aaf8b", "Ltest6_31_r.fam.gz":"b4a859b430942c97b72de22bc9d3e9388495f2f7", "Ltest6_32_f.fam.gz":"ad38d20478eec721422b37631ebaa2fde1d6eb57", "Ltest6_32_r.fam.gz":"98263f9a345988b9575fc0d79c92479645a3d6dc", "Ltest6_33_f.fam.gz":"8605efebdd4e8313f1926b5434130d56b77f0459", "Ltest6_33_r.fam.gz":"f78bb3b1c6e9ec4f5aac213660fdd33d9b353bd7", "Ltest6_34_f.fam.gz":"ec293e90a5928ca1b36c6486374bae270fa11121", "Ltest6_34_r.fam.gz":"1791085faefd1547fd29867162ecb8547cdc7367"}


import gzip 

class TestJamTrim(unittest.TestCase):

    def setUp(self):
        self.jam_root = os.environ.get('JAM_ROOT')
        self.cksum={}
        f = open(os.path.join( self.jam_root,"checksums.txt"))
        while True:
            l=f.readline()
            if not l:
                break
            c=l.strip().split()
            self.cksum[c[0]]=c[1]
        f.close()

    def test_make_trim_commands(self):
        wc = subprocess.call(["kmerpipe.py","--drop","--gspec","Ltest","--debug","--force","--serial"])
        
    def test_trim(self):
        cf=open("Ltest.cmds")
        while True:
            l = cf.readline()
            if not l:
                break
            c=l.strip().split()
            print l.strip()
            wc = subprocess.call(["bash","-c",l.strip()])
            outfilename = c[-1].split(os.sep)[-1]
            fh = gzip.open(c[-1],"rb")
            d = fh.read()
            fh.close()
            print outfilename ,self.cksum.get(outfilename),hashlib.sha1(d).hexdigest()
            self.assertEqual(self.cksum.get(outfilename),hashlib.sha1(d).hexdigest())


if __name__ == '__main__':
    #unittest.main()
    suite = unittest.TestLoader().loadTestsFromTestCase(TestJamTrim)
    unittest.TextTestRunner(verbosity=2).run(suite)
